https://blog.361way.com/huaweicloud-cce-helm-install-pgsql/8561.html


https://blog.stonegarden.dev/articles/2024/10/k8s-postgres/


https://tyk.io/docs/deployment-and-operations/tyk-self-managed/deployment-lifecycle/installations/kubernetes/tyk-helm-tyk-stack-postgresql/

https://www.bmc.com/blogs/kubernetes-postgresql/


stage('Deploiement movie db en dev'){
        environment
        {
        KUBECONFIG = credentials("config") // we retrieve  kubeconfig from secret file called config saved on jenkins
        }
            steps {
                script {
                sh '''
                rm -Rf .kube
                mkdir .kube
				pwd
                ls
                echo $KUBECONFIG > .kube/config
				cd movie_db
                cp values-dev.yaml values.yml
                cat values.yml
                helm upgrade --install moviedb-chart . --values=values.yml --namespace=dev --set image.namespace=dev --set service.name=moviedb --set image.name=moviedb
                '''
                }
            }
        }


stage('Deploiement movie service en dev'){
        environment
        {
        KUBECONFIG = credentials("config")
        }
            steps {
                script {
                sh '''
                rm -Rf .kube
                mkdir .kube
				pwd
                ls
                cat $KUBECONFIG > .kube/config
				cd movie_service
                cp fastapi/values-dev.yaml values.yml
                cat values.yml
                helm upgrade --install app fastapi --values=values.yml --namespace=dev --set image.repository=$DOCKER_ID/$DOCKER_IMAGE_MOVIE --set image.tag=$DOCKER_TAG --set service.port=8001 --set env.SERVER_PORT=8001 --debug --dry-run
                '''
                }
            }
        }